=================================================================
== FILE: /srv/max/cmd/bot/main.go
== DESC: –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª Go-–±–æ—Ç–∞
=================================================================
package main

import (
	"bytes"
	"context"
	"encoding/json"
	"log"
	"net/http"
	"os"
	"os/signal"
	"path/filepath"
	"sync"
	"syscall"
	"time"

	"github.com/joho/godotenv"
	maxbot "github.com/max-messenger/max-bot-api-client-go"
	"github.com/max-messenger/max-bot-api-client-go/schemes"
)

// --- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∏ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è "–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö" –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ID —á–∞—Ç–æ–≤ ---
var (
	userChats   = make(map[int64]bool)
	userChatsMu sync.Mutex
)

// PollForNotify - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–ø—Ä–æ—Å–∞—Ö –æ—Ç Django
type PollForNotify struct {
	ID    int    `json:"id"`
	Title string `json:"title"`
}

// --- –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –æ–ø—Ä–æ—Å–æ–≤ ---
func pollChecker(ctx context.Context, api *maxbot.API, notifyURL string) {
	if notifyURL == "" {
		log.Println("URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø—Ä–æ—Å–æ–≤ –Ω–µ –∑–∞–¥–∞–Ω. –§—É–Ω–∫—Ü–∏—è pollChecker –æ—Ç–∫–ª—é—á–µ–Ω–∞.")
		return
	}
	// –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞, –∞ –∑–∞—Ç–µ–º –ø–æ —Ç–∏–∫–µ—Ä—É
	ticker := time.NewTicker(5 * time.Minute)
	defer ticker.Stop()

	log.Println("–ó–∞–ø—É—â–µ–Ω–∞ —Ñ–æ–Ω–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –æ–ø—Ä–æ—Å–æ–≤...")

	for {
		select {
		case <-ticker.C:
			log.Println("–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–æ–≤—ã—Ö –æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∞–Ω–æ–Ω—Å–∞...")

			// 1. –î–µ–ª–∞–µ–º GET-–∑–∞–ø—Ä–æ—Å –∫ Django API, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∞–Ω–æ–Ω—Å–∞
			resp, err := http.Get(notifyURL)
			if err != nil {
				log.Printf("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ API –æ–ø—Ä–æ—Å–æ–≤: %v", err)
				continue
			}
			defer resp.Body.Close()

			var pollsToNotify []PollForNotify
			if err := json.NewDecoder(resp.Body).Decode(&pollsToNotify); err != nil {
				log.Printf("–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç API –æ–ø—Ä–æ—Å–æ–≤: %v", err)
				continue
			}

			if len(pollsToNotify) == 0 {
				log.Println("–ù–æ–≤—ã—Ö –æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∞–Ω–æ–Ω—Å–∞ –Ω–µ—Ç.")
				continue
			}

			// 2. –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ –æ–ø—Ä–æ—Å—ã, —Ä–∞—Å—Å—ã–ª–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
			userChatsMu.Lock()
			for chatID := range userChats {
				for _, poll := range pollsToNotify {
					log.Printf("–û—Ç–ø—Ä–∞–≤–∫–∞ –∞–Ω–æ–Ω—Å–∞ –æ–ø—Ä–æ—Å–∞ '%s' –≤ —á–∞—Ç %d", poll.Title, chatID)
					text := "üì¢ –ù–æ–≤—ã–π –æ–ø—Ä–æ—Å!\n\nüìÑ " + poll.Title + "\n\n–ü—Ä–∏–º–∏—Ç–µ —É—á–∞—Å—Ç–∏–µ, –≤–∞—à–µ –º–Ω–µ–Ω–∏–µ –≤–∞–∂–Ω–æ!"
					
					// –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É, –≤–µ–¥—É—â—É—é –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø—Ä–æ—Å–æ–≤ –≤ Mini App
					botUsername := os.Getenv("BOT_USERNAME") // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –±–æ—Ç–∞ –¥–ª—è —Å—Å—ã–ª–∫–∏
					miniAppPollsURL := "https://max.ru/" + botUsername + "?startapp=polls" // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É
					keyboard := api.Messages.NewKeyboardBuilder()
					keyboard.AddRow().AddLink("‚úÖ –ü—Ä–æ–π—Ç–∏ –æ–ø—Ä–æ—Å", schemes.POSITIVE, miniAppPollsURL)

					msg := maxbot.NewMessage().SetChat(chatID).SetText(text).AddKeyboard(keyboard)
					api.Messages.Send(ctx, msg)
				}
			}
			userChatsMu.Unlock()

			// 3. –û—Ç–º–µ—á–∞–µ–º –æ–ø—Ä–æ—Å—ã –∫–∞–∫ –∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
			for _, poll := range pollsToNotify {
				postBody, _ := json.Marshal(map[string]int{"id": poll.ID})
				http.Post(notifyURL, "application/json", bytes.NewBuffer(postBody))
				log.Printf("–û–ø—Ä–æ—Å —Å ID %d –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π.", poll.ID)
			}

		case <-ctx.Done():
			log.Println("–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø—Ä–æ—Å–æ–≤.")
			return
		}
	}
}

func main() {
	// --- –®–ê–ì 1: –ó–ê–ì–†–£–ó–ö–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò ---
	log.Println("–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...")
	envPath, _ := filepath.Abs("./.env")
	if err := godotenv.Load(envPath); err != nil {
		log.Fatalf("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ .env —Ñ–∞–π–ª–∞: %v", err)
	}
	botToken := os.Getenv("BOT_TOKEN")
	apiNotifyURL := os.Getenv("API_NOTIFY_URL")

	if botToken == "" {
		log.Fatal("–¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é BOT_TOKEN.")
	}

	// --- –®–ê–ì 2: –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø API –ò –ü–†–û–í–ï–†–ö–ê –¢–û–ö–ï–ù–ê ---
	api, err := maxbot.New(botToken)
	if err != nil {
		log.Fatalf("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è API –∫–ª–∏–µ–Ω—Ç–∞: %v", err)
	}

	ctx := context.Background()

	info, err := api.Bots.GetBot(ctx)
	if err != nil {
		log.Fatalf("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–æ–∫–µ–Ω–∞: %v. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –≤–µ—Ä–Ω—ã–π –∏ –±–æ—Ç –ø—Ä–æ—à–µ–ª –º–æ–¥–µ—Ä–∞—Ü–∏—é.", err)
	}
	log.Printf("–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: %s (ID: %d)", info.Name, info.UserId)
	// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–æ—Ç–∞ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å—Å—ã–ª–∫–∞—Ö
	os.Setenv("BOT_USERNAME", info.Username)

	// --- –®–ê–ì 3: –ù–ê–°–¢–†–û–ô–ö–ê –ì–†–ê–¶–ò–û–ó–ù–û–ì–û –ó–ê–í–ï–†–®–ï–ù–ò–Ø ---
	ctx, cancel := context.WithCancel(context.Background())
	go func() {
		exit := make(chan os.Signal, 1)
		signal.Notify(exit, syscall.SIGTERM, os.Interrupt)
		<-exit
		log.Println("–ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞...")
		cancel()
	}()
	
	// --- –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –æ–ø—Ä–æ—Å–æ–≤ ---
	go pollChecker(ctx, api, apiNotifyURL)

	// --- –®–ê–ì 4: –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ –û–ë–†–ê–ë–û–¢–ö–ò –°–û–ë–´–¢–ò–ô ---
	log.Println("–ó–∞–ø—É—Å–∫ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...")
	for upd := range api.GetUpdates(ctx) {
		switch u := upd.(type) {
		
		case *schemes.MessageCallbackUpdate:
			chatID := u.Message.Recipient.ChatId
			userChatsMu.Lock()
			userChats[chatID] = true // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
			userChatsMu.Unlock()
			// ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ callback ...
			api.Messages.Send(ctx, maxbot.NewMessage().SetChat(chatID).SetText("–≠—Ç–∞ –∫–Ω–æ–ø–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è. –í–≤–µ–¥–∏—Ç–µ /start."))

		case *schemes.MessageCreatedUpdate:
			chatID := u.Message.Recipient.ChatId
			userChatsMu.Lock()
			userChats[chatID] = true // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –∫–∞–∂–¥–æ–≥–æ, –∫—Ç–æ –ø–∏—à–µ—Ç –±–æ—Ç—É
			userChatsMu.Unlock()

			command := u.GetCommand()
			log.Printf("–ü–æ–ª—É—á–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ '%s' –æ—Ç —á–∞—Ç–∞ %d", command, chatID)

			switch command {
			case "/start":
				botUsername := info.Username 
				miniAppLaunchURL := "https://max.ru/" + botUsername + "?startapp"

				keyboard := api.Messages.NewKeyboardBuilder()
				keyboard.AddRow().AddLink("üöÄ –û—Ç–∫—Ä—ã—Ç—å –¶–∏—Ñ—Ä–æ–≤–æ–π –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç", schemes.POSITIVE, miniAppLaunchURL)
				
				text := "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!\n\n–Ø ‚Äî –¶–∏—Ñ—Ä–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¢–∏–º–∏—Ä—è–∑–µ–≤—Å–∫–æ–π –∞–∫–∞–¥–µ–º–∏–∏.\n\n–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã:"
				msg := maxbot.NewMessage().SetChat(chatID).SetText(text).AddKeyboard(keyboard)
				
				_, err := api.Messages.Send(ctx, msg)
				if err != nil {
					log.Printf("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ /start —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π: %v", err)
				}
			case "/help":
				text := "–≠—Ç–æ—Ç –±–æ—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.\n\n" +
					"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /start, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è."
				api.Messages.Send(ctx, maxbot.NewMessage().SetChat(chatID).SetText(text))
			default:
				log.Printf("–ü–æ–ª—É—á–µ–Ω —Ç–µ–∫—Å—Ç: '%s' –æ—Ç —á–∞—Ç–∞ %d", u.GetText(), chatID)
				text := "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –í–≤–µ–¥–∏—Ç–µ /start –¥–ª—è –∑–∞–ø—É—Å–∫–∞."
				api.Messages.Send(ctx, maxbot.NewMessage().SetChat(chatID).SetText(text))
			}
		}
	}
	log.Println("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.")
}


=================================================================
== FILE: /srv/max/go.mod
== DESC: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Go-–±–æ—Ç–∞
=================================================================
module timbot

go 1.23.4

toolchain go1.24.10

require (
	github.com/joho/godotenv v1.5.1
	github.com/max-messenger/max-bot-api-client-go v1.0.3
)

require (
	github.com/caarlos0/env/v6 v6.10.1 // indirect
	github.com/mattn/go-colorable v0.1.13 // indirect
	github.com/mattn/go-isatty v0.0.19 // indirect
	github.com/rs/zerolog v1.34.0 // indirect
	golang.org/x/sys v0.12.0 // indirect
	gopkg.in/yaml.v2 v2.4.0 // indirect
)



=================================================================
== COMMAND: echo 'BOT_TOKEN="YOUR_SECRET_TOKEN_HERE"'
== DESC: –®–∞–±–ª–æ–Ω .env —Ñ–∞–π–ª–∞ –¥–ª—è Go-–±–æ—Ç–∞
=================================================================
BOT_TOKEN="YOUR_SECRET_TOKEN_HERE"



=================================================================
== FILE: /etc/systemd/system/timbot.service
== DESC: Systemd —Å–µ—Ä–≤–∏—Å –¥–ª—è Go-–±–æ—Ç–∞
=================================================================
[Unit]
Description=Timiryazevka Go Bot for MAX Messenger
After=network.target

[Service]
# –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Ç –∏–º–µ–Ω–∏ root, –∫–∞–∫ –∏ –æ–±—Å—É–∂–¥–∞–ª–∏
User=root
Group=root

# –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ Go-–±–æ—Ç–∞
WorkingDirectory=/srv/max

# –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É
ExecStart=/srv/max/bin/timbot

# –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –≤ —Å–ª—É—á–∞–µ —Å–±–æ—è
Restart=always
RestartSec=10

# –ù–∞–ø—Ä–∞–≤–ª—è—Ç—å –≤–µ—Å—å –≤—ã–≤–æ–¥ (–ª–æ–≥–∏) –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∂—É—Ä–Ω–∞–ª
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target



=================================================================
== FILE: /srv/max-mini-app/backend/backend_core/settings.py
== DESC: –ì–ª–∞–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Django
=================================================================
"""
Django settings for backend_core project.

Generated by 'django-admin startproject' using Django 5.2.8.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.2/ref/settings/
"""

from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-hn8%y!ng-50wm%x^zwn^frw@fflm46)#mj2uce3#gu4v!0nvi+'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = ['–º–∞–∫—Å.—Ç–∏–º–∞–∫–∞–¥.—Ä—Ñ', 'xn--80auew.xn--80aamnlk4b.xn--p1ai']


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',

    # --- –°—Ç–æ—Ä–æ–Ω–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ ---
    'rest_framework',
    'corsheaders',
    'tinymce',
    'import_export',  # <<< –î–û–ë–ê–í–¨–¢–ï –≠–¢–£ –°–¢–†–û–ö–£

    # --- –í–∞—à–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
    'api',
    'knowledge_base',
    'polls',
    'schedule',
]

TINYMCE_DEFAULT_CONFIG = {
    "height": "320px",
    "width": "960px",
    "menubar": "file edit view insert format tools table help",
    "plugins": "advlist autolink lists link image charmap print preview anchor searchreplace visualblocks code "
               "fullscreen insertdatetime media table paste code help wordcount spellchecker",
    "toolbar": "undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft "
               "aligncenter alignright alignjustify | outdent indent |  numlist bullist checklist | forecolor "
               "backcolor casechange permanentpen formatpainter removeformat | pagebreak | charmap emoticons | "
               "fullscreen  preview save print | insertfile image media pageembed template link anchor codesample | "
               "a11ycheck ltr rtl | showcomments addcomment code",
    "custom_undo_redo_levels": 10,
}

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'backend_core.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'backend_core.wsgi.application'


# Database
# https://docs.djangoproject.com/en/5.2/ref/settings/#databases

DATABASES = {
    # 'default': {
    #     'ENGINE': 'django.db.backends.sqlite3',
    #     'NAME': BASE_DIR / 'db.sqlite3',
    # }
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'max_app_db',
        'USER': 'max_app_user',
        'PASSWORD': '9923DLEIWAN2002q',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}


# Password validation
# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/5.2/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.2/howto/static-files/

STATIC_URL = '/django-static/'

# Default primary key field type
# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

# –í —Å–∞–º—ã–π –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ settings.py
STATIC_ROOT = BASE_DIR / 'staticfiles'

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.SessionAuthentication',
    ],
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticatedOrReadOnly',
    ],
}


=================================================================
== FILE: /srv/max-mini-app/backend/backend_core/urls.py
== DESC: –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª URL-–∞–¥—Ä–µ—Å–æ–≤ Django
=================================================================
from django.contrib import admin # –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/v1/', include('api.urls')),
    path('tinymce/', include('tinymce.urls')),
]


=================================================================
== FILE: /srv/max-mini-app/backend/api/urls.py
== DESC: URL-–∞–¥—Ä–µ—Å–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è API
=================================================================
# api/urls.py
from django.urls import path, include

urlpatterns = [
    path('kb/', include('knowledge_base.urls')),
    path('polls/', include('polls.urls')),
    path('schedule/', include('schedule.urls')), # –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç—É —Å—Ç—Ä–æ–∫—É
]


=================================================================
== FILE: /srv/max-mini-app/backend/knowledge_base/models.py
== DESC: –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö '–°—Ç–∞—Ç—å—è'
=================================================================
# knowledge_base/models.py

from django.db import models
from tinymce.models import HTMLField

class Article(models.Model):
    title = models.CharField(max_length=255, verbose_name="–ó–∞–≥–æ–ª–æ–≤–æ–∫")
    content = HTMLField(verbose_name="–°–æ–¥–µ—Ä–∂–∏–º–æ–µ")
    created_at = models.DateTimeField(auto_now_add=True, verbose_name="–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è")
    updated_at = models.DateTimeField(auto_now=True, verbose_name="–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è")

    def __str__(self):
        return self.title

    class Meta:
        verbose_name = "–°—Ç–∞—Ç—å—è"
        verbose_name_plural = "–°—Ç–∞—Ç—å–∏"
        ordering = ['-created_at']


=================================================================
== FILE: /srv/max-mini-app/backend/knowledge_base/admin.py
== DESC: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –≤ –∞–¥–º–∏–Ω–∫–µ
=================================================================
# knowledge_base/admin.py

from django.contrib import admin
from .models import Article

@admin.register(Article)
class ArticleAdmin(admin.ModelAdmin):
    list_display = ('title', 'created_at', 'updated_at')
    search_fields = ('title', 'content')


=================================================================
== FILE: /srv/max-mini-app/backend/knowledge_base/serializers.py
== DESC: –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –¥–ª—è API
=================================================================
# knowledge_base/serializers.py

from rest_framework import serializers
from .models import Article

class ArticleListSerializer(serializers.ModelSerializer):
    # –£—Ä–µ–∑–∞–Ω–Ω—ã–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å—Ç–∞—Ç–µ–π
    class Meta:
        model = Article
        fields = ['id', 'title', 'created_at']

class ArticleDetailSerializer(serializers.ModelSerializer):
    # –ü–æ–ª–Ω—ã–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–ª—è –æ–¥–Ω–æ–π —Å—Ç–∞—Ç—å–∏
    class Meta:
        model = Article
        fields = '__all__'


=================================================================
== FILE: /srv/max-mini-app/backend/knowledge_base/views.py
== DESC: –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã API (views)
=================================================================
# knowledge_base/views.py

from rest_framework.decorators import api_view
from rest_framework.response import Response
from .models import Article
from .serializers import ArticleListSerializer, ArticleDetailSerializer

@api_view(['GET'])
def article_list(request):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ç–∞—Ç–µ–π (—Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏)."""
    articles = Article.objects.all()
    serializer = ArticleListSerializer(articles, many=True)
    return Response(serializer.data)

@api_view(['GET'])
def article_detail(request, pk):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω—É —Å—Ç–∞—Ç—å—é –ø–æ –µ–µ ID."""
    try:
        article = Article.objects.get(pk=pk)
        serializer = ArticleDetailSerializer(article)
        return Response(serializer.data)
    except Article.DoesNotExist:
        return Response(status=404)


=================================================================
== FILE: /srv/max-mini-app/backend/knowledge_base/urls.py
== DESC: URL-–∞–¥—Ä–µ—Å–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è '–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π'
=================================================================
# knowledge_base/urls.py
from django.urls import path
from . import views

urlpatterns = [
    path('articles/', views.article_list),
    path('articles/<int:pk>/', views.article_detail),
]


=================================================================
== FILE: /etc/systemd/system/timbot-app.service
== DESC: Systemd —Å–µ—Ä–≤–∏—Å –¥–ª—è Gunicorn/Django
=================================================================
[Unit]
Description=gunicorn daemon for timbot-app
Requires=timbot-app.socket
After=network.target

[Service]
User=www-data
Group=www-data

# –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å manage.py
WorkingDirectory=/srv/max-mini-app/backend

# –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø—É—Ç—å –∫ gunicorn –≤–Ω—É—Ç—Ä–∏ venv
ExecStart=/srv/max-mini-app/backend/venv/bin/gunicorn \
          --access-logfile - \
          --workers 3 \
          --bind unix:/run/timbot-app.sock \
          backend_core.wsgi:application

[Install]
WantedBy=multi-user.target



=================================================================
== FILE: /etc/systemd/system/timbot-app.socket
== DESC: Systemd —Å–æ–∫–µ—Ç –¥–ª—è Gunicorn/Django
=================================================================
[Unit]
Description=gunicorn socket for timbot-app

[Socket]
ListenStream=/run/timbot-app.sock

[Install]
WantedBy=sockets.target



=================================================================
== COMMAND: "/srv/max-mini-app/backend/venv/bin/pip" freeze
== DESC: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python (pip freeze)
=================================================================
asgiref==3.10.0
diff-match-patch==20241021
Django==5.2.8
django-cors-headers==4.9.0
django-import-export==4.3.14
django-tinymce==5.0.0
djangorestframework==3.16.1
gunicorn==23.0.0
packaging==25.0
psycopg2-binary==2.9.11
sqlparse==0.5.3
tablib==3.9.0
typing_extensions==4.15.0



=================================================================
== FILE: /srv/max-mini-app/frontend/package.json
== DESC: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã Frontend
=================================================================
{
  "name": "frontend",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@emotion/react": "^11.14.0",
    "@emotion/styled": "^11.14.1",
    "@fullcalendar/daygrid": "^6.1.19",
    "@fullcalendar/list": "^6.1.19",
    "@fullcalendar/react": "^6.1.19",
    "@fullcalendar/timegrid": "^6.1.19",
    "@mui/icons-material": "^7.3.5",
    "@mui/material": "^7.3.5",
    "@testing-library/dom": "^10.4.1",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.0",
    "@testing-library/user-event": "^13.5.0",
    "@types/jest": "^27.5.2",
    "@types/node": "^16.18.126",
    "@types/react": "^19.2.4",
    "@types/react-dom": "^19.2.3",
    "add-to-calendar-button": "^2.13.0",
    "axios": "^1.13.2",
    "liquid-glass-react": "^1.1.1",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.9.6",
    "react-scripts": "5.0.1",
    "typescript": "^4.9.5",
    "web-vitals": "^2.1.4"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  },
  "devDependencies": {
    "autoprefixer": "^10.4.22",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.18"
  }
}



=================================================================
== FILE: /srv/max-mini-app/frontend/tailwind.config.js
== DESC: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Tailwind CSS
=================================================================
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./src/**/*.{js,jsx,ts,tsx}", // ‚Üê –≠–¢–û –ì–õ–ê–í–ù–û–ï! –°–∫–∞–Ω–∏—Ä—É–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã React
    "./public/index.html",
  ],
  theme: {
    extend: {
      backgroundImage: {
        'noise': "url('data:image/svg+xml,%3Csvg viewBox=%220 0 256 256%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cfilter id=%22noise%22%3E%3CfeTurbulence type=%22fractalNoise%22 baseFrequency=%220.85%22 numOctaves=%224%22 stitchTiles=%22stitch%22/%3E%3C/filter%3E%3Crect width=%22100%25%22 height=%22100%25%22 filter=%22url(%23noise)%22 opacity=%220.06%22/%3E%3C/svg%3E')",
      },
    },
  },
  plugins: [],
}


=================================================================
== FILE: /srv/max-mini-app/frontend/postcss.config.js
== DESC: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PostCSS
=================================================================
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}



=================================================================
== FILE: /srv/max-mini-app/frontend/src/index.tsx
== DESC: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ React
=================================================================
import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from './App';
import reportWebVitals from './reportWebVitals';

const root = ReactDOM.createRoot(
  document.getElementById('root') as HTMLElement
);
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);

// If you want to start measuring performance in your app, pass a function
// to log results (for example: reportWebVitals(console.log))
// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals
reportWebVitals();



=================================================================
== FILE: /srv/max-mini-app/frontend/src/App.tsx
== DESC: –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏ —Ä–æ—É—Ç–µ—Ä
=================================================================
// src/App.tsx
import React from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import { CssBaseline, ThemeProvider } from '@mui/material';
import { theme } from './theme'; // –ù–∞—à–∞ –Ω–æ–≤–∞—è —Ç–µ–º–∞
import { MainLayout } from './layouts/MainLayout'; // –ù–∞—à –Ω–æ–≤—ã–π –ª–µ–π–∞—É—Ç
import { ArticleListPage } from './pages/ArticleListPage';
import { ArticleDetailPage } from './pages/ArticleDetailPage';
import { SchedulePage } from './pages/SchedulePage';
import { PollsPage } from './pages/PollsPage';
import { ManageSchedulePage } from './pages/ManageSchedulePage';

function App() {
  return (
    <ThemeProvider theme={theme}>
      <CssBaseline />
      <BrowserRouter>
        {/* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í—Å–µ <Route> —Ç–µ–ø–µ—Ä—å –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ <Routes> */}
        <Routes>
          {/* 
            –≠—Ç–æ—Ç Route —Å —ç–ª–µ–º–µ–Ω—Ç–æ–º MainLayout –¥–µ–π—Å—Ç–≤—É–µ—Ç –∫–∞–∫ "–æ–±–µ—Ä—Ç–∫–∞".
            –í—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –≤ –Ω–µ–≥–æ Route –±—É–¥—É—Ç –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω—ã –≤–Ω—É—Ç—Ä–∏ MainLayout.
          */}
          <Route path="/" element={<MainLayout />}>
            {/* `index` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –¥–ª—è –ø—É—Ç–∏ "/" */}
            <Route index element={<ArticleListPage />} /> 
            <Route path="schedule" element={<SchedulePage />} />
            <Route path="polls" element={<PollsPage />} />
            <Route path="article/:id" element={<ArticleDetailPage />} />
            <Route path="manage/schedule" element={<ManageSchedulePage />} />
          </Route>
        </Routes>
      </BrowserRouter>
    </ThemeProvider>
  );
}

export default App;


=================================================================
== FILE: /srv/max-mini-app/frontend/src/theme.ts
== DESC: –¢–µ–º–∞ Material UI
=================================================================
// src/theme.ts
import { createTheme } from '@mui/material/styles';

export const theme = createTheme({
  palette: {
    mode: 'light', // –ú–æ–∂–µ—Ç–µ –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ 'dark' –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
    primary: {
      main: '#006400', // –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ç–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç
    },
    secondary: {
      main: '#f57c00', // –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π, —Ö–æ—Ä–æ—à–æ —Å–æ—á–µ—Ç–∞–µ—Ç—Å—è —Å –∑–µ–ª–µ–Ω—ã–º
    },
    background: {
      default: '#f4f6f8', // –°–ª–µ–≥–∫–∞ —Å–µ—Ä—ã–π —Ñ–æ–Ω, –ø—Ä–∏—è—Ç–Ω–µ–µ —á–∏—Å—Ç–æ-–±–µ–ª–æ–≥–æ
      paper: '#ffffff',
    },
  },
  typography: {
    fontFamily: 'Roboto, sans-serif',
    h4: {
      fontWeight: 700,
    },
    h5: {
      fontWeight: 600,
    },
  },
  components: {
    // –î–æ–±–∞–≤–∏–º —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∏ –∫–∞—Ä—Ç–æ—á–µ–∫
    MuiButton: {
      styleOverrides: {
        root: {
          borderRadius: 8,
        },
      },
    },
    MuiPaper: {
      styleOverrides: {
        root: {
          borderRadius: 12,
        },
      },
    },
    MuiListItemButton: {
        styleOverrides: {
          root: {
            borderRadius: 8,
          },
        },
      },
  },
});


=================================================================
== FILE: /srv/max-mini-app/frontend/src/layouts/MainLayout.tsx
== DESC: –ì–ª–∞–≤–Ω—ã–π –ª–µ–π–∞—É—Ç —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
=================================================================
// src/layouts/MainLayout.tsx
import React, { useState, useEffect } from 'react';
import { Outlet, useNavigate, useLocation } from 'react-router-dom';
import { Box, Paper, BottomNavigation, BottomNavigationAction } from '@mui/material';
import ArticleIcon from '@mui/icons-material/Article';
import EventIcon from '@mui/icons-material/Event';
import PollIcon from '@mui/icons-material/Poll';

export const MainLayout: React.FC = () => {
    const navigate = useNavigate();
    const location = useLocation();
    const [value, setValue] = useState(location.pathname);

    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É —Å —Ç–µ–∫—É—â–∏–º URL
    useEffect(() => {
        setValue(location.pathname);
    }, [location.pathname]);

    return (
        <Box sx={{ pb: 7 }}> {/* –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É, —Ä–∞–≤–Ω—ã–π –≤—ã—Å–æ—Ç–µ –ø–∞–Ω–µ–ª–∏ */}
            
            {/* –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–∞—à–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */}
            <Outlet />

            <Paper 
                sx={{ 
                    position: 'fixed', 
                    bottom: 0, 
                    left: 0, 
                    right: 0,
                    // --- –°—Ç–∏–ª–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ "Liquid Glass" ---
                    backgroundColor: 'rgba(255, 255, 255, 0.7)', // –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω
                    backdropFilter: 'blur(10px)', // –†–∞–∑–º—ã—Ç–∏–µ
                    WebkitBackdropFilter: 'blur(10px)', // –î–ª—è Safari
                    borderTop: '1px solid rgba(0, 0, 0, 0.12)',
                }} 
                elevation={3}
            >
                <BottomNavigation
                    showLabels
                    value={value}
                    onChange={(event, newValue) => {
                        navigate(newValue);
                    }}
                    sx={{ backgroundColor: 'transparent' }} // –¥–µ–ª–∞–µ–º —Ñ–æ–Ω —Å–∞–º–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º
                >
                    <BottomNavigationAction label="–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π" value="/" icon={<ArticleIcon />} />
                    <BottomNavigationAction label="–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ" value="/schedule" icon={<EventIcon />} />
                    <BottomNavigationAction label="–û–ø—Ä–æ—Å—ã" value="/polls" icon={<PollIcon />} />
                </BottomNavigation>
            </Paper>
        </Box>
    );
};



=================================================================
== FILE: /srv/max-mini-app/frontend/src/pages/ArticleListPage.tsx
== DESC: –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞—Ç–µ–π
=================================================================
// src/pages/ArticleListPage.tsx
import React, { useState, useEffect } from 'react';
import axios from 'axios';
import { Link as RouterLink } from 'react-router-dom';
import { Container, Typography, List, ListItem, ListItemText, CircularProgress, Box, ListItemButton, Paper } from '@mui/material';

// –û–ø–∏—Å—ã–≤–∞–µ–º, –∫–∞–∫ –≤—ã–≥–ª—è–¥—è—Ç –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –≤ —Å–ø–∏—Å–∫–µ (–¥–ª—è TypeScript)
interface ArticleListItem {
    id: number;
    title: string;
    created_at: string;
}

export const ArticleListPage: React.FC = () => {
    const [articles, setArticles] = useState<ArticleListItem[]>([]);
    const [loading, setLoading] = useState<boolean>(true);

    // –≠—Ç–æ—Ç —Ö—É–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    useEffect(() => {
        // –î–µ–ª–∞–µ–º GET-–∑–∞–ø—Ä–æ—Å –∫ –Ω–∞—à–µ–º—É Django API
        axios.get('/api/v1/kb/articles/')
            .then(response => {
                setArticles(response.data);
                setLoading(false);
            })
            .catch(error => {
                console.error("There was an error fetching the articles!", error);
                setLoading(false);
            });
    }, []); // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ–∑–Ω–∞—á–∞–µ—Ç "–≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑"

    if (loading) {
        return (
            <Box display="flex" justifyContent="center" alignItems="center" minHeight="80vh">
                <CircularProgress />
            </Box>
        );
    }

    return (
        <Container maxWidth="md" sx={{ py: 4 }}>
            <Typography variant="h4" component="h1" gutterBottom color="primary">
                –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
            </Typography>
            <Paper elevation={2}>
                <List>
                    {articles.length > 0 ? articles.map(article => (
                        <ListItem key={article.id} disablePadding>
                            <ListItemButton component={RouterLink} to={`/article/${article.id}`}>
                                <ListItemText 
                                    primary={article.title} 
                                    secondary={`–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: ${new Date(article.created_at).toLocaleDateString()}`} 
                                />
                            </ListItemButton>
                        </ListItem>
                    )) : (
                        <ListItem>
                            <ListItemText primary="–ü–æ–∫–∞ –∑–¥–µ—Å—å –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–π —Å—Ç–∞—Ç—å–∏." />
                        </ListItem>
                    )}
                </List>
            </Paper>
        </Container>
    );
};


=================================================================
== FILE: /srv/max-mini-app/frontend/src/pages/ArticleDetailPage.tsx
== DESC: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç—å–∏
=================================================================
// src/pages/ArticleDetailPage.tsx
import React, { useState, useEffect } from 'react';
import axios from 'axios';
import { useParams, Link as RouterLink } from 'react-router-dom';
import { Container, Typography, Paper, CircularProgress, Box, Button } from '@mui/material';

interface ArticleDetail {
    id: number;
    title: string;
    content: string; // –≠—Ç–æ –±—É–¥–µ—Ç HTML-—Å—Ç—Ä–æ–∫–∞ –æ—Ç TinyMCE
}

export const ArticleDetailPage: React.FC = () => {
    const [article, setArticle] = useState<ArticleDetail | null>(null);
    const [loading, setLoading] = useState<boolean>(true);
    const { id } = useParams<{ id: string }>(); // –ü–æ–ª—É—á–∞–µ–º ID –∏–∑ URL

    useEffect(() => {
        if (id) {
            axios.get(`/api/v1/kb/articles/${id}/`)
                .then(response => {
                    setArticle(response.data);
                    setLoading(false);
                })
                .catch(error => {
                    console.error(`There was an error fetching the article with id ${id}!`, error);
                    setLoading(false);
                });
        }
    }, [id]); // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç, –µ—Å–ª–∏ ID –∏–∑–º–µ–Ω–∏–ª—Å—è

    if (loading) {
        return (
            <Box display="flex" justifyContent="center" alignItems="center" minHeight="80vh">
                <CircularProgress />
            </Box>
        );
    }

    if (!article) {
        return (
            <Container maxWidth="md" sx={{ py: 4, textAlign: 'center' }}>
                <Typography variant="h5">–°—Ç–∞—Ç—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.</Typography>
                <Button component={RouterLink} to="/" variant="contained" sx={{ mt: 2 }}>
                    –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É
                </Button>
            </Container>
        );
    }

    return (
        <Container maxWidth="md" sx={{ py: 4 }}>
            <Button component={RouterLink} to="/" variant="outlined" sx={{ mb: 2 }}>
                &larr; –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
            </Button>
            <Paper elevation={3} sx={{ p: { xs: 2, sm: 3, md: 4 } }}>
                <Typography variant="h4" component="h1" gutterBottom color="primary">
                    {article.title}
                </Typography>
                {/* 
                  –í–ê–ñ–ù–û: –û—Ç–æ–±—Ä–∞–∂–∞–µ–º HTML-–∫–æ–Ω—Ç–µ–Ω—Ç –∏–∑ –∞–¥–º–∏–Ω–∫–∏. 
                  –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –∫–æ–Ω—Ç–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞–º–∏. 
                  –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!
                */}
                <Typography component="div" sx={{ 
                    mt: 2, 
                    '& p': { mb: 1.5 }, // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º–∏
                    '& h1, & h2, & h3': { mt: 2.5, mb: 1, fontWeight: 'bold' }, // –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
                    '& a': { color: 'primary.main', textDecoration: 'underline' }, // –°—Ç–∏–ª–∏ –¥–ª—è —Å—Å—ã–ª–æ–∫
                    '& ul, & ol': { pl: 2.5 }, // –û—Ç—Å—Ç—É–ø—ã –¥–ª—è —Å–ø–∏—Å–∫–æ–≤
                    '& blockquote': { borderLeft: 4, borderColor: 'grey.300', pl: 2, fontStyle: 'italic' } // –°—Ç–∏–ª–∏ –¥–ª—è —Ü–∏—Ç–∞—Ç
                }}>
                    <div dangerouslySetInnerHTML={{ __html: article.content }} />
                </Typography>
            </Paper>
        </Container>
    );
};


=================================================================
== FILE: /srv/max-mini-app/frontend/src/pages/SchedulePage.tsx
== DESC: –°—Ç—Ä–∞–Ω–∏—Ü–∞-–∑–∞–≥–ª—É—à–∫–∞ '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ'
=================================================================
// src/pages/SchedulePage.tsx
import React, { useState, useEffect } from 'react';
import axios from 'axios';
import { Container, Typography, CircularProgress, Box, Paper } from '@mui/material';

import FullCalendar from '@fullcalendar/react';
import listPlugin from '@fullcalendar/list';
import { EventContentArg } from '@fullcalendar/core';

// –ü—Ä–æ—Å—Ç–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º, —á—Ç–æ–±—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–µ–±-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
// –¢–∏–ø—ã –º—ã –æ–ø–∏—Å–∞–ª–∏ –≤ global.d.ts
import 'add-to-calendar-button';

interface CalendarEvent {
    title: string;
    start: string;
    end: string;
    extendedProps: {
        teacher: string;
        room: string;
    }
}

export const SchedulePage: React.FC = () => {
    const [events, setEvents] = useState<CalendarEvent[]>([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        axios.get('/api/v1/schedule/view/')
            .then(response => {
                const formattedEvents = response.data.map((event: any) => ({
                    title: event.subject,
                    start: event.start_time,
                    end: event.end_time,
                    extendedProps: {
                        teacher: event.teacher,
                        room: event.room,
                    }
                }));
                setEvents(formattedEvents);
            })
            .finally(() => setLoading(false));
    }, []);

    if (loading) {
        return <Box display="flex" justifyContent="center" mt={4}><CircularProgress /></Box>;
    }

    return (
        <Container maxWidth="md" sx={{ py: 4 }}>
            <Typography variant="h4" component="h1" gutterBottom color="primary">
                –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π
            </Typography>
            <Paper elevation={2} sx={{ p: 2 }}>
                <FullCalendar
                    plugins={[listPlugin]}
                    initialView="listWeek"
                    headerToolbar={false}
                    locale="ru"
                    events={events}
                    noEventsText="–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –∑–∞–Ω—è—Ç–∏–π –Ω–µ—Ç"
                    eventContent={(eventInfo: EventContentArg) => (
                        <Box sx={{ display: 'flex', width: '100%', alignItems: 'center', py: 1 }}>
                            <Box sx={{ flexGrow: 1 }}>
                                <Typography variant="body1" fontWeight="bold">{eventInfo.event.title}</Typography>
                                <Typography variant="body2" color="text.secondary">
                                    {eventInfo.event.extendedProps.teacher as string}
                                </Typography>
                                <Typography variant="body2" color="text.secondary">
                                    –ê—É–¥–∏—Ç–æ—Ä–∏—è: {eventInfo.event.extendedProps.room as string}
                                </Typography>
                            </Box>
                            <add-to-calendar-button
                                name={eventInfo.event.title}
                                startDate={eventInfo.event.startStr.substring(0, 10)}
                                startTime={eventInfo.event.startStr.substring(11, 16)}
                                endTime={eventInfo.event.endStr.substring(11, 16)}
                                timeZone="Europe/Moscow"
                                location={eventInfo.event.extendedProps.room as string}
                                options="'Apple','Google','iCal'"
                                light
                                buttonStyle="round"
                            />
                        </Box>
                    )}
                />
            </Paper>
        </Container>
    );
};


=================================================================
== FILE: /srv/max-mini-app/frontend/src/pages/PollsPage.tsx
== DESC: –°—Ç—Ä–∞–Ω–∏—Ü–∞-–∑–∞–≥–ª—É—à–∫–∞ '–û–ø—Ä–æ—Å—ã'
=================================================================
// src/pages/PollsPage.tsx
import React, { useState, useEffect } from 'react';
import axios from 'axios';
import { Container, Typography, CircularProgress, Box, Paper, Accordion, AccordionSummary, AccordionDetails, RadioGroup, FormControlLabel, Radio, Button } from '@mui/material';
import ExpandMoreIcon from '@mui/icons-material/ExpandMore';

// ... (–∑–¥–µ—Å—å –±—É–¥—É—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è Poll, Question, Choice) ...

export const PollsPage: React.FC = () => {
    const [polls, setPolls] = useState<any[]>([]); // –ó–∞–º–µ–Ω–∏—Ç–µ any –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
    const [loading, setLoading] = useState(true);

    const fetchPolls = () => {
        axios.get('/api/v1/polls/')
            .then(res => setPolls(res.data))
            .finally(() => setLoading(false));
    };

    useEffect(fetchPolls, []);
    
    const handleVote = (choiceId: number) => {
        axios.post(`/api/v1/polls/choices/${choiceId}/vote/`)
            .then(res => {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø—Ä–æ—Å–æ–≤, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                fetchPolls();
            })
            .catch(err => console.error("Voting error:", err));
    };

    if (loading) return <Box display="flex" justifyContent="center" mt={4}><CircularProgress /></Box>;

    return (
        <Container maxWidth="md" sx={{ py: 4 }}>
            <Typography variant="h4" component="h1" gutterBottom color="primary">
                –û–ø—Ä–æ—Å—ã –∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
            </Typography>
            {polls.length === 0 ? (
                <Typography>–ê–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç.</Typography>
            ) : (
                polls.map(poll => (
                    <Paper key={poll.id} elevation={2} sx={{ mb: 2 }}>
                        <Accordion>
                            <AccordionSummary expandIcon={<ExpandMoreIcon />}>
                                <Typography variant="h6">{poll.title}</Typography>
                            </AccordionSummary>
                            <AccordionDetails>
                                <Typography paragraph>{poll.description}</Typography>
                                {poll.questions.map((q: any) => (
                                    <div key={q.id}>
                                        <Typography variant="subtitle1" sx={{ mt: 1, fontWeight: 'bold' }}>{q.text}</Typography>
                                        {/* –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è */}
                                        {q.choices.map((c: any) => (
                                             <Box key={c.id} display="flex" justifyContent="space-between" alignItems="center">
                                                <Typography>{c.text}</Typography>
                                                <Box display="flex" alignItems="center">
                                                    <Typography sx={{ mr: 2 }}>{c.votes} –≥–æ–ª–æ—Å–æ–≤</Typography>
                                                    <Button size="small" variant="outlined" onClick={() => handleVote(c.id)}>–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å</Button>
                                                </Box>
                                             </Box>
                                        ))}
                                    </div>
                                ))}
                            </AccordionDetails>
                        </Accordion>
                    </Paper>
                ))
            )}
        </Container>
    );
};


=================================================================
== FILE: /srv/max-mini-app/frontend/public/index.html
== DESC: –ì–ª–∞–≤–Ω—ã–π HTML-—Ñ–∞–π–ª —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
=================================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>React App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>



=================================================================
== FILE: /srv/max-mini-app/frontend/.env
== DESC: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
=================================================================
HTTPS=true



=================================================================
== FILE: /etc/nginx/sites-available/timbot-app
== DESC: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx –¥–ª—è –¥–æ–º–µ–Ω–∞
=================================================================
# =================================================================
# Django Backend (API) Server
# =================================================================
server {
    # –≠—Ç–æ—Ç –±–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–∞–±–æ—Ç—É API –Ω–∞ –ø–æ—Ä—Ç—É 443 (HTTPS)
    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name xn--80auew.xn--80aamnlk4b.xn--p1ai; # –í–∞—à –¥–æ–º–µ–Ω –≤ Punycode

    # --- SSL-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ—Ç Certbot (–ù–ï –¢–†–û–ì–ê–¢–¨) ---
    ssl_certificate /etc/letsencrypt/live/xn--80auew.xn--80aamnlk4b.xn--p1ai/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/xn--80auew.xn--80aamnlk4b.xn--p1ai/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

    # --- –ë–õ–û–ö 1: –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ API –Ω–∞ Django/Gunicorn ---
    location /api/ {
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_pass http://unix:/run/timbot-app.sock;
    }

    # --- –ë–õ–û–ö 2: –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –ê–¥–º–∏–Ω–∫–∏ –Ω–∞ Django/Gunicorn ---
    location /admin/ {
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_pass http://unix:/run/timbot-app.sock;
    }

    # --- –ë–õ–û–ö 3: –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –†–ê–ó–î–ê–ß–ê –°–¢–ê–¢–ò–ö–ò DJANGO ---
    #    Nginx –æ—Ç–¥–∞–µ—Ç —Ñ–∞–π–ª—ã –Ω–∞–ø—Ä—è–º—É—é, –Ω–µ —Ç—Ä–æ–≥–∞—è Gunicorn.
    location /django-static/ {
        # –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ, –∫–æ—Ç–æ—Ä—É—é –º—ã —Å–æ–∑–¥–∞–ª–∏ –∫–æ–º–∞–Ω–¥–æ–π 'python manage.py collectstatic'
        alias /srv/max-mini-app/backend/staticfiles/;
    }

    # --- –ë–õ–û–ö 4: –í–°–ï –û–°–¢–ê–õ–¨–ù–´–ï –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–∫—Å–∏—Ä—É–µ–º –Ω–∞ React Dev Server ---
    location / {
        # –ë—ã–ª–æ:
        # proxy_pass http://localhost:3001;
        
        # –°—Ç–∞–ª–æ:
        proxy_pass https://localhost:3001;

        # –î–æ–±–∞–≤–ª—è–µ–º –¥–∏—Ä–µ–∫—Ç–∏–≤—É, —á—Ç–æ–±—ã Nginx –¥–æ–≤–µ—Ä—è–ª —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–º—É
        # —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ React
        proxy_ssl_verify off;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ WebSocket (–Ω—É–∂–Ω—ã –¥–ª—è Hot Reload)
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}

# =================================================================
# –†–µ–¥–∏—Ä–µ–∫—Ç —Å HTTP –Ω–∞ HTTPS
# =================================================================
server {
    # –≠—Ç–æ—Ç –±–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö
    # –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∑–∞—â–∏—â–µ–Ω–Ω—É—é HTTPS-–≤–µ—Ä—Å–∏—é
    listen 80;
    listen [::]:80;
    
    server_name xn--80auew.xn--80aamnlk4b.xn--p1ai; # –í–∞—à –¥–æ–º–µ–Ω –≤ Punycode

    # --- –ü—Ä–∞–≤–∏–ª–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –æ—Ç Certbot (–ù–ï –¢–†–û–ì–ê–¢–¨) ---
    if ($host = xn--80auew.xn--80aamnlk4b.xn--p1ai) {
        return 301 https://$host$request_uri;
    } # managed by Certbot
    
    return 404; # managed by Certbot
}


